## 17. 변경 가능성을 최소화하라

- 불변 클래스란 그 객체의 내부 값을 수정할 수 없는 클래스다. 

---

### 1. 불변 클래스를 만드는 규칙

1. 객체의 상태를 변경하는 메소드를 제공하지 않는다.
2. 클래스를 확장할 수 없도록 한다.
   - 하위 클래스에서 나쁜 의도로 객체의 상태를 변하게 만드는 사태를 막아준다.
   - `final` 클래스로 선언할 수도 있지만 생성자를 private으로 선언하고 정적 팩토리 메소드를 제공하여 상속을 할 수 없게 만들 수 있다.
3. 모든 필드를 final로 선언한다.
4. 모든 필드를 private으로 선언한다.
   - 필드가 참조하는 가변 객체를 클라이언트에서 직접 접근해서 수정할 수 없게한다.
   - 원시 타입이나 불변 객체를 참조하는 필드를 `public final` 로 선언하여 클라이언트가 접근할 수 있도록 하면 클라이언트가 값을 바꿀 수는 없지만 내부 표현을 바꿀 수는 없는 단점이 있다.
5. 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.
   - 클래스에 가변 객체를 참조하는 필드가 있다면 이러한 필드는 절대로 클라이언트가 제공한 객체를 참조해서는 안된다.
   - `접근자 메소드`가 이 필드를 그대로 반환하게 해서도 안된다.  

---

### 2. 불변 클래스를 사용하는 이유가 무엇인가?

1. 여러 스레드들에 의해서 참조되어도 절대 값이 바뀌지 않으므로 따로 동기화할 필요가 없다.

2. 불변 클래스들은 자주 사용되는 객체를 캐싱하여 중복 생성하지 않도록 하는 정적 팩토리 메소드를 제공할 수 있다.
   - 이러한 정적 팩토리 메소드를 제공하면 여러 클라이언트가 객체를 공유하기 때문에 메모리 사용량과 가비지 컬렉션 비용이 줄어든다.
   - 새로운 클래스를 설계할 때, 정적 팩토리 메소드를 만들어두면 클라이언트를 수정하지 않고서도 캐시 기능을 추가할 수 있다.

3. `Map과 Set`의 원소로 쓰이는 객체는 반드시 불변이어야 한다.
   - 가변 객체를 Map의 key로 저장한 뒤에 내부의 값이 변경되면 Map에서 get을 통해 해당 객체를 넘긴다고 해도 null을 반환하게 될 것이다.

---

### 3. 주의할 점

1. 클래스는 꼭 필요한 경우가 아니라면 불변이어야 한다.
   - `getter` 메소드가 있다고 해서 무조건 `setter`를 만들지 말자.
2. 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분을 최소한으로 줄이자.
   - 객체가 가질 수 있는 상태의 수를 줄이면 오류가 발생할 가능성이 줄어든다.
   - 그러니 꼭 변경이 필요한 필드를 제외하고는 모두를 final로 선언하자.